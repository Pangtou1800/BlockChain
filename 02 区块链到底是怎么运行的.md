# 02 区块链到底是怎么运行的

    今天我就以比特币为例来通俗地介绍一下区块链是怎么运行的。

    选比特币有两个原因：
        1.区块链发展到目前阶段，各个技术方向都有长足的发展，
        不过比特币区块链依然是最简单、最容易理解的
        2.大部分区块链都是以比特币区块链为基础进行扩充的，
        所以首先了解比特币也有助于其他区块链的后续学习

## 中心化记账的问题

    首先，我们借助一个区块链常用的经典情景来模拟中心化记账。

    有一个百户居民的村子，村长德高望重，大家都把钱存到村长家。
    村名之间的交易，也由村长来进行结算。比如张三用1000块买了李四的牛，
    那村长就把张三名下的存款减去1000，把李四名下的存款加上1000。
    就像现在的银行一样。

    后来村长不愿意帮大家记账了，村民中也没有人愿意负责全村的记账工作，
    大家就不能转账了。

    后来，有个叫中本聪的人站了出来，他说他设计了一套系统，
    可以不依赖于村长或者任何的个人就能记账。

    他的方法是这样的。

### 1. 公开记账

    中本聪说他的系统比之前的中心化系统稍微麻烦一点，需要做3件事：
        
        ·每家每户都派发一只信鸽
        ·每家每户都派发一个独自的印章和配套的扫描器
        ·每家每户都可以记账，不过记的不是余额，而是交易

    其中，这个扫描器有两个功能，一是识别他人的交易是否有效，
    二是识别这个交易是不是自己的，同时也能够读出未花费的余额。
    （每家都有自己的地址、公钥、私钥，其中地址是公钥的哈希）

    这里的交易，也不是金融意义上的Trade，而是一次交易的动作（Transaction）。

    这3件事其实就是想实现一个功能：
        每家每户都记账，而且记的账是每一笔交易的付款人、收款人和金额。

    不计账户余额而是记录交易历史，显然需要一个初始状态。

    创建初始状态的过程，就是创建创世区块。

### 2. 创建创世区块

    先把全村人的存款都加起来，假设刚好是100万。
    然后就生成一个付款人为空，收款人为村长的Transaction，付款给村长100万。

    接下来，利用信鸽把村长有100万的信息送给每个村民，
    这个步骤就是“同步区块”，也就是全网都拿到这个信封，以及信封里面的Transaction。

### 3. 交易

    接着，按照村长现在拿着的账本上每人的存款额，依次由村长付款给每个村民。

    如果我们的交易过程可以可持续进行，那么村长向每个村民付过钱后，
    每个人的初始账目现在就存进公开账簿里了，而且以后记账转账都直接进行就可以了。

    那么一次交易要怎么进行呢？中本聪教村长写交易单。
    100万分成两部分，10万给张三，90万给村长自己。

    村长得到张三的地址，再利用自己的印章，写一条交易记录：

    >
        上次交易为交易000，本次交易为交易001

        转账内容：10万
        来自：村长（13GYIP）- 村长的地址
        付给：张三（1S25VR）- 张三的地址

        付款人：村长（QS34DFETY） - 村长的公钥
        付款人签名：87WE8500Q - 村长的私钥生成的数字签名
    >

    之后村长又要给李四转账5万，那么就再写一条交易记录：

    >
        上次交易为交易001，本次交易为交易002

        转账内容：5万
        来自：村长（13GYIP）- 村长的地址
        付给：李四（2D36WS）- 李四的地址

        付款人：村长（QS34DFETY） - 村长的公钥
        付款人签名：23DI3499E - 村长的私钥生成的数字签名
    >

    这两条交易记录都会通过信鸽发给所有人。

    每个人都可以验证一下记录是不是真的是村长发出的。

    比如说交易002。

    首先，村长要转5万块出去，要先查村长是不是有5万块余额。
    于是，查到上一个交易，村长余额为-10万。
    接着再向上查，查到村长余额为100-10=90万。
    到达了创世记录，确认村长确实有支付能力。
    （？？每次都要追溯到创世记录吗？？）

    接着，用村长的公钥计算村长的地址，确保这个公钥是正确的公钥。

    最后，用村长的公钥解析付款人签名，解密之后是获得明文“002-50000-13GYIP-2D36WS”。
    （猜想。。）

    至此，这条记录就不可能为假，每个人就都把这条交易记录记了下来。

    其他人想要伪造一条交易记录非常地困难，因为无法生成出付款人签名。

### 4. 挖矿

    村长写好10条交易记录之后就送信给众人。
    大家一看，10条交易记录刚好打成一个包，适宜作为一个记录的单位。

    中本聪这时宣布，谁算出了这个包的一个规定范围内的哈希值，就给谁发1块钱。
    于是，大家都跑去算，最先算出来的人又把这个包、自己算出来的结果和算出来的时间
    发信给所有人。其他人看着他确实算对了，那这个包的打包工钱就归他所有了。
    于是所有人就将这个包记录了下来。

    这个打包了10条记录的人，就挖矿成功，赚到了1块钱。
