# 17 去中心化与区块链交易性能

    比特币与以太坊的TPS一直遭到技术领域的人的诟病，或许这与工程师“高性能高并发”的情节有关。

    去中心化与高性能TPS是否真的可以做到鱼与熊掌兼得？
    区块链业界又采取了哪些方案进行改善？
    今天我们就来看一看这两个问题。

## 再谈去中心化

    区块链的最大的标签就是“去中心化”，在任何讨论区块链的场合这个词都会被提到。

    全球顶级数字资产交易平台OKEX的负责人徐明星曾经发文表示，业界应该避免使用“去中心化”
    这样的词汇，而改用“点对点”。“点对点”一词后来甚至直接被冠名到了比特币的白皮书上。

    因为去中心化这个说法树立了一个无形的靶子，正如我们说P2P网络，而不说去中心化网络一样，
    技术领域里，使用“点对点”而不是“去中心化”可以避免这个概念被过度消费。

    说到过度消费，我认为去中心化已经演变成了区块链行业对外宣传的消费概念，这是一种情怀消费。
    它消费了人们对强权的不满，例如店大欺客的商家、死皮赖脸的中间商、缺乏诚信的供应商。
    这些内容你在生活中或多或少都经历过。当“去中心化”的口号响起的时候，人们终于找到了一个
    发泄口，放大了区块链的光环，造成了区块链能够引起一场巨大革新的错觉。

    革新肯定是有的，但是我认为去中心化只是一个表面现象。如果我们更加深入地去理解，
    就可以发现数字货币和数字资产带来的更多是交易效率的成倍提升。

    人类的现代文明就是建立在交易的基础上的，所以交易效率的提升才是区块链价值的根本所在。
    那么，为什么区块链这样看似低效的TPS，反而提高了交易效率呢？

    先回顾一下传统的交易模式。

    交易首先是基于中心化平台的。置身中心化平台内部的时候，交易的效率是很高的。
    但是如果环顾整个交易的生命周期，就会发现可能这个平台只是交易的一个环节，
    平台和平台之间的协作似乎并不是那么顺畅。

    跨境支付就是典型的例子，市值常居TOP3的区块链项目Ripple就是为了解决跨境支付的难题
    而产生的。

    再来看区块链点对点的交易模式。它的TPS看似很低，但是它提供了全局无缝衔接的资金流转过程。
    这减少了交易的整个生命周期的步骤，也是区块链提升交易效率的关键所在。

    所以说，中心化服务虽然能够提供高性能服务，但是慢在人工审核、平台间衔接、内部审计，
    平台之间的协作业务推进一向是很低效的。

### 技术上的去中心化

    我们在聊DPoS共识机制的时候，提到过一个TPS计算公式：

        TPS = (block_size * network_bandwidth * witness_performance)/
                (block_time * witness_count)
    
    其中witness_count(记账节点数目)与准入门槛在业界的争议比较大。
    如果要完全去中心化，首先就意味着记账节点没有准入门槛，记账节点数无限多。
    显然这只是一个理想环境，并没有工程可实施性。

    比特币的全球节点有1.2万个，而大大小小的挖矿节点只有几十个，常出块的则只有5大矿池，
    但是比特币依然没有限制记账节点的准入门槛，以太坊也是如此。
    而在EOS中，既规定了记账节点的数目，又规定了准入门槛。

    可以这么说，控制了记账节点的数量和准入门槛，就等于决定了区块链TPS的大小。

    为了帮助你深入理解去中心化与TPS的关系，我们再次回到之前一直提到的CAP定理中。

    CAP定理中，C为最终一致性，决定了出块时间长短；A是可用性，是区块链的必选项，
    也就是保证7*24*365可用。

    P是网络分区容忍性，它的含义在区块链中有两层。
    第一层是必须保证分区可容忍，也就是一旦因为网络分叉而导致区块链分叉，
    必须有一种机制可以合并区块链；第二层含义是如果能够尽量避免出现网络分区，
    那么就可以避免P的出现，从而提升C的性能。

    C和P是可以相互调整的，有两种情况：

        1.如果我们选择拉长C - 最终一致性的确认时间，那么对P的要求会减弱，
        也就是说产生网络分区也不要紧，反正一段时间后恢复一致即可。

        2.如果我们选择调整P - 也就是限制记账节点的数量，并且对记账节点之间的带宽提出要求，
        降低网络分区的出现概率，那么对C的要求就会减弱，可以降低出块时间。
    
    第1点就是比特币和以太坊的思路，而第2点就是EOS采用的思路。

    区块链属于分布式系统，通过简单的分析就可以知道，它的交易TPS和去中心化程度具有不可调和性，
    任何一个号称TPS过万的区块链项目肯定是极其中心化的（至少在技术实现上是）。

    那些试图兼具高性能与去中心化的工作注定大多是徒劳的。

### 各个区块链的TPS指标

    我们来看一些实际的区块链项目的TPS指标。

||BTC|ETH|EOS|MIOTA|BTS|Cardano|
|-|-|-|-|-|-|-|
|共识机制<br>Consensus|PoW|PoW|DPoS+BFT|MCMC+PoW|DPoS|PoS|
|每秒事务处理量<br>TPS|5~7|7~14|1M(理论)|1000+|3300|未知|
|总供应量<br>Millions|21|可定增|1, 000|2, 780|3, 600|45, 000|
|代币发行模式|纯挖矿|ICO:60M(x)<br>早期开发者、基金会：12M(0.198x)<br>每年挖矿增加：12M(递减)|ICO:1, 000M<br>100M: 自己保留<br>100M:17年6月26日-7月1日发行<br>700M: 分350个阶段分发<br>不需要挖矿|ICO:2, 780(100%)<br>不需要挖矿|ICO:2, 000M<br>后续增发了500M<br>不需要挖矿|ICO:30, 000(2/3)<br>剩余通过POS分配|
|公链上线时间|09年1月|15年7月|无|16年11月|15年10月|18年第二季度|
|交易费结算方式|BTC|Gas|暂无|无|BTS|未知|
|是否支持ERC20|否|是|否|否|否|否|

    上面TPS在1000以上的区块链项目，都控制了记账节点的数量，牺牲了去中心化特性提升了TPS，
    比如石墨烯系列的DPoS，Ripple的共识。

    PoW、PoS型公链偏好AP特性，相应地TPS也有限。
    联盟链和DPoS型共识偏好比较均匀，可以达到可观的TPS。

### 可选方案之一：Sharding分片

    虽然有上面的CAP定理的结论，但是业界还是使出浑身解数来尽可能地提升TPS。
    目前大致有两种方案：Sharding分片技术和闪电网络。闪电网络旨在解决比特币微小额支付
    的实时性问题，算是比特币的一种扩展算法。

    分片技术则是一种安装传统数据可分片的拓展，主要思路是将数据库分成多个碎片并
    将分区放置在不同的服务器上。

    在区块链场景下，全网节点相当于分布式数据库中的不同服务器，这时候我们可以将一笔交易
    分成不同的部分，然后每个记账节点只需要验证交易的一部分就可以了，而不必验证完整的交易性。

    这样做的好处就是可以并行化处理，记账节点之间相当于是协作关系，而不是单纯的独立关系。
    随着网络的增长，这种协作关系也可以随之扩展，也就是水平扩容。

    分片技术有以下优势：首先是TPS可以提升至少两个数量级，也就是从几十笔每秒到千笔每秒，
    这不但是应用友好的，而且也能提升用户体验；其次是TPS的提升可以带来更过应用，
    这写应用在共识的激励下可以水平扩展区块链的性能，形成一种良性循环。

    下面我介绍两种分片方案：网络分片、状态分片。

    网络分片是我们按照网络进行分区，区域内的交易归集在一起并在区域内进行验证，
    这样区域内的用户就可以享受低延迟高吞吐的TPS，但是会带来跨区域分片的复杂性。

    状态分片则是以太坊上提出的方案，目前还在讨论中，没有确切的技术方案。
    思路大致可以类比数据库的分表，将同一张表的数据放到不同的节点，这些节点分步在
    全世界并且没有可信的网络环境。这使得状态分片相对复杂，最终实践结果还要看以太坊的后续动作。